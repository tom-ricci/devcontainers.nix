# generated by generate-github-actions
# Do not edit.

name: build-image-{{ package }}

concurrency:
  group: "devcontainers.nix-build-image-{{ package }}"
  cancel-in-progress: true

on:
  workflow_dispatch:
  push:
    branches: ["master"]

# # buggy https://github.com/orgs/community/discussions/41518
# concurrency:
#   group: "tom-ricci-devcontainers-nix"
#   cancel-in-progress: false

jobs:

{% if "x86_64-linux" in systems %}
  build-{{ package }}-amd64:
    uses: ./.github/workflows/build.yml
    with:
      runs-on: ubuntu-latest
      package: {{ package }}
      free-disk-space: true
{% endif %}

{% if "aarch64-linux" in systems %}
  build-{{ package }}-arm64:
    uses: ./.github/workflows/build.yml
    with:
      runs-on: ubuntu-24.04-arm
      package: {{ package }}
      free-disk-space: true
{% endif %}

  manifest:
    needs:
{% if "x86_64-linux" in systems %}
      - build-{{ package }}-amd64
{% endif %}
{% if "aarch64-linux" in systems %}
      - build-{{ package }}-arm64
{% endif %}
    uses: ./.github/workflows/manifest.yml
    with:
      package: {{ package }}
      free-disk-space: true
